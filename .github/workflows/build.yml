name: Build Android APK (Original Code)

on:
  workflow_dispatch: # 这是一个手动触发的开关，避免每次提交都构建

jobs:
  build-apk:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 设置 Python 环境
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # 使用较新的 Python 尝试获得更好的库支持

      # 安装打包工具
      - name: Install Build Tools
        run: |
          pip install flet
          # 安装 cookiecutter，这是 flet build 内部需要的工具
          pip install cookiecutter

      # 开始打包
      - name: Build APK
        run: |
          # --include-packages 强制包含所有依赖
          # 注意：这一步会尝试拉取 scikit-learn 的二进制包
          flet build apk --verbose --project "BioScanner Pro" --org "com.bioscanner.app" --include-packages flet,numpy,pandas,opencv-python,scikit-learn

      # 上传结果
      - name: Upload APK
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: BioScanner-Original-APK
          path: build/apk/release.apk
